<font size = '4'>
<p align = "center">
<b>
Resources Used 
</b>
</p>
</font>

<br>
<font size = '3'>

- https://expressjs.com/en/starter/hello-world.html
- https://www.codecademy.com/article/what-is-crud
- https://expressjs.com/en/guide/database-integration.html
- https://stackoverflow.com/questions/39870867/what-does-app-usebodyparser-json-do
- https://developer.mozilla.org/en-US/docs/Web/HTTP/Status
- https://planetscale.com/blog/how-to-prevent-sql-injection-attacks-in-node-js
- https://stackoverflow.com/questions/41677815/how-to-loop-through-node-js-array
- https://stackoverflow.com/questions/3010840/loop-through-an-array-in-javascript
- 

Error:<br>
- ReferenceError: title is not defined<br>
Solution: https://stackoverflow.com/questions/37732986/ejs-js-referenceerror-title-not-defined<br><br>

<b>Rewriting code to prevent SQL Injection:</b><br>
<br>
Original code for updating record:

    const bID = parseInt(req.params.id);

    const { title, author } = req.body;

    const updateData = [];

    const lettersAndNumbersPattern = /^[A-Za-z0-9]+$/;

    if (title) updateData.push(`title = '${title}'`);
    if (author) updateData.push(`author = '${author}'`);

    query = `UPDATE books SET ${updateData.join(', ')} WHERE id = ?`;

New code for updating record:

    const bID = parseInt(req.params.id);

    const { title, author } = req.body;

    const updateData = [];

    const lettersAndNumbersPattern = /^[A-Za-z0-9]+$/;

    // Added code to check for special characters to prevent sqli
    if(!title.match(lettersAndNumbersPattern) || !author.match(lettersAndNumbersPattern)) {
        return res.status(400).json({ err: "No special characters please!"});
    }

    if (title) updateData.push(`title = '${title}'`);
    if (author) updateData.push(`author = '${author}'`);

    query = `UPDATE books SET ${updateData.join(', ')} WHERE id = ?`;

<br><br><br>

Updating code to prevent SQL Injection using placeholders:

New code:

    app.put('/books/:id', (req, res) => {

        const bID = parseInt(req.params.id);

        const { title, author } = req.body;

        if (title) {
            query = `UPDATE books SET title = ? WHERE id = ?`;
            db.run (query, [title, bID], (err) => {
                if (err) {
                    console.error(err.message);
                    return res.status(500).send('Error updating book record');
                }
    
                console.log(`Book title updated`);
            });
        }

        if (author) {
            query = `UPDATE books SET author = ? WHERE id = ?`;
            db.run (query, [author, bID], (err) => {
                if (err) {
                    console.error(err.message);
                    return res.status(500).send('Error updating book record');
                }
    
                console.log(`Book author updated`);
            }); 
        }

        res.status(200).send('Book updated successfully');
    });

XSS Vulnerability:

Was showing up cause I used the innerHTML method, which interpreted the user input as HTML code. Fixed this using the following changes to the get endpoint:

    async function getAllBooks() {
      const response = await fetch('/books');
      const data = await response.json();

      const container = document.createElement('div');

      for (var i = 0; i < data.length; i++) {
          //console.log(data[i]);
          const bookInfo = document.createElement('div');
          bookInfo.textContent = data[i].id + ". " + data[i].title + " - " + data[i].author;
          container.appendChild(bookInfo);
          const lineBreak = document.createElement('br');
          container.appendChild(lineBreak);
      }

      const result = document.getElementById('getAllBooksResult');
      result.innerHTML = '';
      result.appendChild(container);
    }

I created an empty container (a div element) that I'll use to hold the data. For each book, we create another smaller div element to hold the book id, title, and author, as a raw string. We append this to the original container, then create a lineBreak container to store the br element, and append that as well. This way, any HTML code gets converted to raw string.

</font>